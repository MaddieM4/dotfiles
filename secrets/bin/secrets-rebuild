#!/bin/bash
set -ex

if !(op vault list); then
  eval $(op signin)
fi

gen_secret_line() {
  local env_variable_name="$1"
  local item_name="$2"
  local item_field="$3"
  local item_value="$(op item get "$item_name" --fields "$item_field")"

  echo "export ${env_variable_name}='${item_value}'"
}

gen_all_lines() {
  gen_secret_line NTFY_TOKEN ntfy token
}

gen_all_lines > ~/.secrets/env
